syntax = "proto3";

package user;

import "api.proto";

option go_package = "basic/user";

message Badge{
  int64 id = 1;        // 徽章id
  string name = 2;     // 徽章名
  string image_url = 3; // 徽章图片链接
  bool unlocked = 4;    // 徽章是否已经解锁
  string unlock_conditions = 5;
}

message UserContributions{
  int64 total_days = 1;         // 任务总参与天数
  int64 consecutive_days = 2;  // 当前连续参与天数
  int64 max_consecutive_days = 3; // 历史最长参与天数
}

message UserPointsLogs{
  int64 total_points = 1;   // 总积分
  int64 base_points = 2;   // 基础积分
  int64 extra_points = 3;   // 额外的积分
  string type = 4;    // 类型
  int64 create_time = 5;  // 创建时间
}

message GetUserProfileRequest{}
message GetUserProfileResponse{
  int64 uid = 1;                         // 用户id
  string address = 2;                    // 用户地址
  string user_name = 3;                  // 用户昵称
  string avatar_url = 4;                 // 用户头像
  int64 points = 5;                      // 用户总积分
  repeated Badge badges = 6;             // 用户获取的徽章
  UserContributions contributions = 7;   // 用户参与活动的贡献
  repeated UserPointsLogs points_logs = 8; // 用户最近5次的积分历史
  int64 sbt_token_id = 9;                // 用户的SBT NFT tokenID
}

message SetUserProfileRequest{
  string user_name = 1;
  string avatar_url = 2;
}
message SetUserProfileResponse{
  bool status = 1;
}


message UserRanking{
  string address = 1;   // 地址
  string user_name = 2; //用户名
  int64 points = 3;   // 用户积分
}

message GetUserRankingRequest{
  string type = 1;     // 按照天/周/总榜: enum: daily, weekly, all
}
message GetUserRankingResponse{
  int64 user_ranking = 1;                 // 用户自己的排名
  repeated UserRanking ranking_list = 2;  // 所有用户的排名
}

service UserHandler {

  rpc UserGetUserProfile(GetUserProfileRequest) returns(GetUserProfileResponse) {
    option (api.get) = "/api/user/get-user-profile/";
  }

  rpc UserSetUserProfile(SetUserProfileRequest) returns(SetUserProfileResponse) {
    option (api.post) = "/api/user/set-user-profile/";
  }

  rpc UserGetUserRanking(GetUserRankingRequest) returns(GetUserRankingResponse) {
    option (api.get) = "/api/user/get-user-ranking/";
  }
}